From 97a0360f8ee65f422fc6a29e71b8b9fa33096e02 Mon Sep 17 00:00:00 2001
From: Samuel Holland <samuel@sholland.org>
Date: Fri, 31 Aug 2018 20:13:56 -0500
Subject: [PATCH 13/14] Disable OpenSSL assembly for powerpc64 musl

musl uses the ELFv2 ABI; OpenSSL's assembly is ELFv1.

Signed-off-by: Samuel Holland <samuel@sholland.org>
---
 src/bootstrap/native.rs | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/bootstrap/native.rs b/src/bootstrap/native.rs
index b8089a4879..2721ab1687 100644
--- a/src/bootstrap/native.rs
+++ b/src/bootstrap/native.rs
@@ -648,6 +648,10 @@ impl Step for Openssl {
             configure.arg("-mandroid");
             configure.arg("-fomit-frame-pointer");
         }
+        if target == "powerpc64-unknown-linux-musl" {
+            // OpenSSL ships ELFv1 assembly files
+            configure.arg("no-asm");
+        }
         if target == "sparc64-unknown-netbsd" {
             // Need -m64 to get assembly generated correctly for sparc64.
             configure.arg("-m64");
-- 
2.16.4

