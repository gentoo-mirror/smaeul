From 29d431f731a4df577a6498d0bab38533040d487f Mon Sep 17 00:00:00 2001
From: beck <>
Date: Fri, 4 Nov 2016 10:29:19 +0000
Subject: [PATCH] Add X509_up_ref, from boring ok jsing@

---
 include/openssl/x509.h  | 4 +++-
 crypto/x509/x_all.c | 9 ++++++++-
 2 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/include/openssl/x509.h b/include/openssl/x509.h
index d960f39..e166fc1 100644
--- a/include/openssl/x509.h
+++ b/include/openssl/x509.h
@@ -1281,6 +1281,8 @@ int X509_TRUST_get_flags(X509_TRUST *xp);
 char *X509_TRUST_get0_name(X509_TRUST *xp);
 int X509_TRUST_get_trust(X509_TRUST *xp);
 
+int X509_up_ref(X509 *x);
+
 /* BEGIN ERROR CODES */
 /* The following lines are auto generated by the script mkerr.pl. Any changes
  * made after this point may be overwritten when the script is next run.
diff --git a/crypto/x509/x_all.c b/crypto/x509/x_all.c
index 3bda2a7..1f524ad 100644
--- a/crypto/x509/x_all.c
+++ b/crypto/x509/x_all.c
@@ -600,3 +600,10 @@ PKCS7_ISSUER_AND_SERIAL_digest(PKCS7_ISSUER_AND_SERIAL *data,
 	return(ASN1_item_digest(ASN1_ITEM_rptr(PKCS7_ISSUER_AND_SERIAL), type,
 	    (char *)data, md, len));
 }
+
+int
+X509_up_ref(X509 *x)
+{
+	int i = CRYPTO_add(&x->references, 1, CRYPTO_LOCK_X509);
+	return i > 1 ? 1 : 0;
+}
